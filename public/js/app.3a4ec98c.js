(function(){"use strict";var a={5317:function(a,e,t){var n=t(9242),l=t(3396);function o(a,e,t,n,o,i){const d=(0,l.up)("AdminLayout");return(0,l.wg)(),(0,l.j4)(d)}const i={class:"main light"},d={class:"header"},r={class:"body"};function s(a,e,t,n,o,s){const c=(0,l.up)("AdminHeaderBar"),p=(0,l.up)("router-view");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l._)("div",d,[(0,l.Wm)(c,{"is-logged-in":a.isLoggedIn},null,8,["is-logged-in"])]),(0,l._)("div",r,[(0,l.Wm)(p)])])}var c=t(678),p=t(4870),u=t(6265),m=t.n(u);const h=()=>{const a=(0,p.iH)(),e=(0,p.iH)(""),t=(0,p.iH)("none"),n=async()=>{const n=await m().get("/api/me"),l=n.data;a.value=l.data.logged_in,t.value=l.data.role,e.value=l.data.tenant.display_name};(0,l.bv)((()=>{n()}));const o=async()=>{await n()};return{tenantDisplayName:e,isLoggedIn:a,role:t,refetch:o}},g=a=>((0,l.dD)("data-v-7b15653d"),a=a(),(0,l.Cn)(),a),y={class:"header-bar"},w=g((()=>(0,l._)("h1",{class:"brand"},[(0,l._)("img",{src:"/img/isuports_light.svg",alt:"ISUPORTS",width:"250",height:"60"})],-1))),v=g((()=>(0,l._)("h2",{class:"subtitle"},"Admin Panel",-1))),f={class:"actions"};function _(a,e,t,n,o,i){return(0,l.wg)(),(0,l.iD)("div",y,[w,v,(0,l._)("div",f,[a.isLoggedIn?((0,l.wg)(),(0,l.iD)("button",{key:0,type:"button",onClick:e[0]||(e[0]=(...e)=>a.handleLogout&&a.handleLogout(...e))},"ログアウト")):(0,l.kq)("",!0)])])}var b=(0,l.aZ)({props:{isLoggedIn:{type:Boolean,default:!1}},setup(){const a=(0,c.tv)(),e=async()=>{try{await m().post("/auth/logout");a.push("/")}catch(e){window.alert("failed to logout")}};return{handleLogout:e}}}),C=t(89);const k=(0,C.Z)(b,[["render",_],["__scopeId","data-v-7b15653d"]]);var D=k,A=(0,l.aZ)({name:"AdminLayout",components:{AdminHeaderBar:D},setup(){const{isLoggedIn:a,refetch:e}=h(),t=(0,c.tv)();t.afterEach((async(a,t)=>{await e(),n(a.fullPath)}));const n=e=>{a.value?"/"===e&&t.push("/admin/"):"/"!==e&&t.push("/")};return{isLoggedIn:a}}});const L=(0,C.Z)(A,[["render",s],["__scopeId","data-v-43edf4cf"]]);var H=L,T=(0,l.aZ)({name:"AdminApp",components:{AdminLayout:H}});const x=(0,C.Z)(T,[["render",o]]);var I=x;function z(a,e,t,n,o,i){const d=(0,l.up)("TenantLayout");return(0,l.wg)(),(0,l.j4)(d)}const U={class:"main dark"},S={class:"header"},Z={class:"body"};function M(a,e,t,n,o,i){const d=(0,l.up)("TenantHeaderBar"),r=(0,l.up)("router-view");return(0,l.wg)(),(0,l.iD)("div",U,[(0,l._)("div",S,[(0,l.Wm)(d,{"tenant-name":a.tenantDisplayName,"is-logged-in":a.isLoggedIn,role:a.role},null,8,["tenant-name","is-logged-in","role"])]),(0,l._)("div",Z,[(0,l.Wm)(r)])])}var P=t(7139);const B=a=>((0,l.dD)("data-v-54b781ca"),a=a(),(0,l.Cn)(),a),W={class:"header-bar"},F=B((()=>(0,l._)("h1",{class:"brand"},[(0,l._)("img",{src:"/img/isuports_light.svg",alt:"ISUPORTS",width:"250",height:"60"})],-1))),O={class:"subtitle"},V={class:"actions"};function q(a,e,t,n,o,i){return(0,l.wg)(),(0,l.iD)("div",W,[F,(0,l._)("h2",O,(0,P.zw)(a.tenantName),1),(0,l._)("div",V,["organizer"!==a.role?((0,l.wg)(),(0,l.iD)("button",{key:0,type:"button",onClick:e[0]||(e[0]=(...e)=>a.handleAssumeOrganizerRole&&a.handleAssumeOrganizerRole(...e))},"テナント管理者モードに切り替える")):(0,l.kq)("",!0),a.isLoggedIn?((0,l.wg)(),(0,l.iD)("button",{key:1,type:"button",onClick:e[1]||(e[1]=(...e)=>a.handleLogout&&a.handleLogout(...e))},"ログアウト")):(0,l.kq)("",!0)])])}var N=(0,l.aZ)({name:"TenantHeaderBar",props:{tenantName:{type:String,default:"鎌倉ISUPORTS同好会"},isLoggedIn:{type:Boolean,default:!1},role:{type:String,default:"none"}},setup(){const a=(0,c.tv)(),e=async()=>{try{await m().post("/auth/login/organizer");a.push("/organizer/")}catch(e){window.alert("failed to assume organizer role")}},t=async()=>{try{await m().post("/auth/logout");a.push("/")}catch(e){window.alert("failed to logout")}};return{handleAssumeOrganizerRole:e,handleLogout:t}}});const R=(0,C.Z)(N,[["render",q],["__scopeId","data-v-54b781ca"]]);var j=R,$=(0,l.aZ)({name:"TenantLayout",components:{TenantHeaderBar:j},setup(){const{isLoggedIn:a,role:e,tenantDisplayName:t,refetch:n}=h(),l=(0,c.tv)();l.afterEach((async(a,e)=>{await n(),o(a.fullPath)}));const o=t=>{a.value?"player"===e.value?("/"===t||t.startsWith("/organizer"))&&l.push("/mypage"):"organizer"===e.value&&("/"!==t&&t.startsWith("/organizer")||l.push("/organizer/")):"none"===e.value&&"/"!==t&&l.push("/")};return{tenantDisplayName:t,isLoggedIn:a,role:e}}});const Y=(0,C.Z)($,[["render",M],["__scopeId","data-v-30ece58c"]]);var K=Y,E=(0,l.aZ)({name:"TenantApp",components:{TenantLayout:K}});const G=(0,C.Z)(E,[["render",z]]);var J=G;const Q=a=>((0,l.dD)("data-v-5dbf67ca"),a=a(),(0,l.Cn)(),a),X={class:"lp"},aa=Q((()=>(0,l._)("h2",null,"管理画面へのログイン",-1))),ea=Q((()=>(0,l._)("label",{for:"account"}," アカウント ",-1))),ta=Q((()=>(0,l._)("input",{type:"submit",value:"認証する"},null,-1)));function na(a,e,t,o,i,d){return(0,l.wg)(),(0,l.iD)("div",X,[aa,(0,l._)("form",{onSubmit:e[1]||(e[1]=(0,n.iM)(((...e)=>a.handleSubmit&&a.handleSubmit(...e)),["prevent"]))},[ea,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[0]||(e[0]=e=>a.account=e),type:"text",name:"account",id:"account",placeholder:"admin"},null,512),[[n.nr,a.account]]),ta],32)])}var la=(0,l.aZ)({setup(){const a=(0,c.tv)(),e=(0,p.iH)(""),t=async()=>{try{const t=await m().post("/auth/login/admin",new URLSearchParams({id:e.value}));if(200!=t.status)return void window.alert("Failed to Login: status="+t.status);a.push("/admin/")}catch(t){window.alert("Failed to Login: "+t)}};return{account:e,handleSubmit:t}}});const oa=(0,C.Z)(la,[["render",na],["__scopeId","data-v-5dbf67ca"]]);var ia=oa;const da=a=>((0,l.dD)("data-v-701892e7"),a=a(),(0,l.Cn)(),a),ra={class:"admin"},sa=da((()=>(0,l._)("h2",null,"テナント一覧",-1))),ca=["href"],pa={key:0},ua={colspan:"4",class:"loading"},ma=(0,l.Uk)(" 読み込み中... "),ha=da((()=>(0,l._)("span",{class:"cycle-loop"},"の",-1)));function ga(a,e,t,o,i,d){const r=(0,l.up)("AddTenantModal"),s=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",ra,[(0,l._)("button",{class:"add-tenant",onClick:e[0]||(e[0]=(...e)=>a.handleAddTenant&&a.handleAddTenant(...e))}," テナント追加 "),(0,l.wy)((0,l.Wm)(r,{onClose:a.handleAddTenantClose,onTenantAdded:a.handleTenantAdded},null,8,["onClose","onTenantAdded"]),[[n.F8,a.showModal]]),sa,(0,l.Wm)(s,{header:a.tableHeader,data:a.tableData,"row-attr":a.tenants},{"cell-name":(0,l.w5)((a=>[(0,l._)("a",{href:`https://${a.row.name}.t.isucon.dev/`},(0,P.zw)(a.row.name),9,ca)])),footer:(0,l.w5)((()=>[a.noMoreLoad?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("tr",pa,[(0,l._)("td",ua,[a.isLoading?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[ma,ha],64)):((0,l.wg)(),(0,l.iD)("button",{key:1,type:"button",class:"slim",onClick:e[1]||(e[1]=(...e)=>a.handleLoading&&a.handleLoading(...e))},"さらに読み込む"))])]))])),_:1},8,["header","data","row-attr"])])}function ya(a,e,t,n,o,i){return(0,l.wg)(),(0,l.iD)("table",null,[(0,l._)("thead",null,[(0,l._)("tr",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.header,((a,e)=>((0,l.wg)(),(0,l.iD)("th",{key:e,style:(0,P.j5)({textAlign:"center",width:a.width})},(0,P.zw)(a.text),5)))),128))])]),(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.data,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{key:`idx-${t}`},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e,((e,n)=>((0,l.wg)(),(0,l.iD)("td",{key:`idx-${t}-${n}`,style:(0,P.j5)({textAlign:a.header[n].align,width:a.header[n].width})},[e.startsWith("##slot##")?(0,l.WI)(a.$slots,e.replace("##slot##",""),{key:0,row:a.rowAttr[t]},void 0,!0):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Uk)((0,P.zw)(e),1)],64))],4)))),128))])))),128))]),(0,l._)("tfoot",null,[(0,l.WI)(a.$slots,"footer",{},void 0,!0)])])}var wa=(0,l.aZ)({name:"TableBase",props:{header:{type:Array,default:()=>[]},data:{type:Array,default:()=>[]},rowAttr:{type:Array,default:()=>[]}},setup(a){return{}}});const va=(0,C.Z)(wa,[["render",ya],["__scopeId","data-v-5899f1e7"]]);var fa=va;const _a=a=>((0,l.dD)("data-v-9eb4cd0a"),a=a(),(0,l.Cn)(),a),ba=_a((()=>(0,l._)("h3",null,"新規テナント追加",-1))),Ca=_a((()=>(0,l._)("label",null,"テナント名(サブドメイン)",-1))),ka=_a((()=>(0,l._)("br",null,null,-1))),Da=_a((()=>(0,l._)("label",null,"テナント表示名",-1)));function Aa(a,e,t,o,i,d){const r=(0,l.up)("ModalBase");return(0,l.wg)(),(0,l.j4)(r,{applyText:"作成","cancel-text":"キャンセル",onApply:a.handleApply,onClose:a.handleClose},{default:(0,l.w5)((()=>[ba,(0,l._)("form",null,[Ca,(0,l.wy)((0,l._)("input",{type:"text",name:"tenant_name","onUpdate:modelValue":e[0]||(e[0]=e=>a.tenantName=e)},null,512),[[n.nr,a.tenantName]]),ka,Da,(0,l.wy)((0,l._)("input",{type:"text",name:"tenant_display_name","onUpdate:modelValue":e[1]||(e[1]=e=>a.tenantDisplayName=e)},null,512),[[n.nr,a.tenantDisplayName]])])])),_:1},8,["onApply","onClose"])}const La={class:"action"};function Ha(a,e,t,o,i,d){return(0,l.wg)(),(0,l.iD)("div",{class:"modal-outer",onClick:e[3]||(e[3]=(...e)=>a.handleOuterClick&&a.handleOuterClick(...e))},[(0,l._)("div",{class:"modal-inner",onClick:e[2]||(e[2]=(0,n.iM)(((...e)=>a.handleInnerClick&&a.handleInnerClick(...e)),["stop"]))},[(0,l.WI)(a.$slots,"default",{},void 0,!0),(0,l._)("div",La,[a.cancelText?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"cancel",onClick:e[0]||(e[0]=(...e)=>a.handleCancel&&a.handleCancel(...e))},(0,P.zw)(a.cancelText),1)):(0,l.kq)("",!0),a.applyText?((0,l.wg)(),(0,l.iD)("button",{key:1,class:"apply",onClick:e[1]||(e[1]=(...e)=>a.handleApply&&a.handleApply(...e))},(0,P.zw)(a.applyText),1)):(0,l.kq)("",!0)])])])}var Ta=(0,l.aZ)({name:"ModalBase",props:{applyText:{type:String,default:"OK"},cancelText:{type:String,default:"Cancel"},show:{type:Boolean,default:!1}},emit:["close","apply"],setup(a,e){const t=()=>{e.emit("close")},n=()=>{},l=()=>{e.emit("close")},o=()=>{e.emit("apply"),e.emit("close")};return{handleOuterClick:t,handleInnerClick:n,handleApply:o,handleCancel:l}}});const xa=(0,C.Z)(Ta,[["render",Ha],["__scopeId","data-v-5fd0771a"]]);var Ia=xa,za=(0,l.aZ)({name:"AddTenantModal",components:{ModalBase:Ia},emits:["tenantAdded"],setup(a,e){const t=(0,p.iH)(""),n=(0,p.iH)(""),l=async()=>{const a=await m().post("/api/admin/tenants/add",new URLSearchParams({name:t.value,display_name:n.value}));a.data.status&&e.emit("tenantAdded",{id:a.data.data.tenant.id,name:a.data.data.tenant.name,display_name:a.data.data.tenant.display_name,billing:a.data.data.tenant.billing})},o=()=>{t.value="",n.value=""};return{tenantName:t,tenantDisplayName:n,handleApply:l,handleClose:o}}});const Ua=(0,C.Z)(za,[["render",Aa],["__scopeId","data-v-9eb4cd0a"]]);var Sa=Ua,Za=(0,l.aZ)({components:{TableBase:fa,AddTenantModal:Sa},props:{isLoggedIn:{type:Boolean,required:!0}},setup(){const{isLoggedIn:a}=h(),e=(0,p.iH)([]),t=(0,p.iH)(""),n=(0,p.iH)(!1),o=(0,p.iH)(!1),i=async a=>{const l=new URLSearchParams;a&&l.append("before",a),n.value=!0;try{const a=await m().get("/api/admin/tenants/billing",{params:l}),i=a.data;if(!i.status)return void window.alert("Failed to fetch tenant list: status=false");if(!i.data.tenants.length)return void(o.value=!0);e.value.push(...i.data.tenants),t.value=i.data.tenants[i.data.tenants.length-1].id,i.data.tenants.length<10&&(o.value=!0)}catch(i){window.alert("Failed to fetch tenants list")}finally{n.value=!1}};(0,l.bv)((()=>{setTimeout((()=>{a.value&&i("")}),250)}));const d=()=>{i(t.value)},r=(0,p.iH)(!1),s=()=>{r.value=!0},c=()=>{r.value=!1},u=a=>{e.value.unshift(a)},g=[{width:"10%",align:"center",text:"ID"},{width:"20%",align:"center",text:"テナント名"},{width:"45%",align:"left",text:"表示名"},{width:"15%",align:"right",text:"請求額"}],y=(0,l.Fl)((()=>e.value.map((a=>[a.id,"##slot##cell-name",a.display_name,a.billing.toLocaleString()+"円"]))));return{tenants:e,handleLoading:d,isLoading:n,noMoreLoad:o,showModal:r,handleAddTenant:s,handleAddTenantClose:c,handleTenantAdded:u,tableHeader:g,tableData:y}}});const Ma=(0,C.Z)(Za,[["render",ga],["__scopeId","data-v-701892e7"]]);var Pa=Ma;const Ba=[{path:"/",name:"home",component:ia},{path:"/admin/",name:"admin",component:Pa},{path:"/:catchall(.*)",name:"notfound",redirect:"/"}],Wa=(0,c.p7)({history:(0,c.PO)("/"),routes:Ba});var Fa=Wa;const Oa=a=>((0,l.dD)("data-v-c3ea5c96"),a=a(),(0,l.Cn)(),a),Va={class:"lp"},qa={class:"box"},Na=Oa((()=>(0,l._)("h2",null,"プレイヤーサイトへログイン",-1))),Ra=Oa((()=>(0,l._)("label",{for:"account"}," アカウントID ",-1))),ja=Oa((()=>(0,l._)("input",{type:"submit",value:"認証する"},null,-1)));function $a(a,e,t,o,i,d){return(0,l.wg)(),(0,l.iD)("div",Va,[(0,l._)("div",qa,[Na,(0,l._)("form",{onSubmit:e[1]||(e[1]=(0,n.iM)(((...e)=>a.handleSubmit&&a.handleSubmit(...e)),["prevent"]))},[Ra,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":e[0]||(e[0]=e=>a.account=e),type:"text",name:"account",id:"account",placeholder:"badcab1e"},null,512),[[n.nr,a.account]]),ja],32)])])}var Ya=(0,l.aZ)({setup(){const a=(0,c.tv)(),e=(0,p.iH)(""),t=async()=>{try{const t=await m().post("/auth/login/player",new URLSearchParams({id:e.value}));if(200!=t.status)return void window.alert("Failed to Login: status="+t.status);a.push("/mypage")}catch(t){window.alert("Failed to Login: "+t)}};return{account:e,handleSubmit:t}}});const Ka=(0,C.Z)(Ya,[["render",$a],["__scopeId","data-v-c3ea5c96"]]);var Ea=Ka;const Ga=a=>((0,l.dD)("data-v-6110fe8a"),a=a(),(0,l.Cn)(),a),Ja={class:"mypage"},Qa=Ga((()=>(0,l._)("h2",null," 大会一覧 ",-1)));function Xa(a,e,t,n,o,i){const d=(0,l.up)("router-link"),r=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",Ja,[Qa,(0,l.Wm)(r,{header:a.tableHeader,data:a.tableData,"row-attr":a.competitions},{"cell-title":(0,l.w5)((a=>[(0,l.Wm)(d,{to:`/competition/${a.row.id}`},{default:(0,l.w5)((()=>[(0,l.Uk)((0,P.zw)(a.row.title),1)])),_:2},1032,["to"])])),_:1},8,["header","data","row-attr"])])}var ae=(0,l.aZ)({name:"MyPageView",components:{TableBase:fa},setup(){const a=(0,p.iH)([]),e=async()=>{const e=await m().get("/api/player/competitions");e.data.status?a.value=e.data.data.competitions:window.alert("failed to fetch competitions: status=false")};(0,l.bv)((()=>{e()}));const t=()=>{},n=(0,p.iH)(!1),o=(0,p.iH)(!1),i=[{width:"20%",align:"center",text:"大会ID"},{width:"60%",align:"left",text:"大会名"},{width:"20%",align:"center",text:"完了ステータス"}],d=(0,l.Fl)((()=>a.value.map((a=>[a.id,"##slot##cell-title",a.is_finished?"大会完了":"開催中"]))));return{competitions:a,isLoading:n,noMoreLoad:o,handleLoading:t,tableHeader:i,tableData:d}}});const ee=(0,C.Z)(ae,[["render",Xa],["__scopeId","data-v-6110fe8a"]]);var te=ee;const ne=a=>((0,l.dD)("data-v-77713802"),a=a(),(0,l.Cn)(),a),le={class:"competition"},oe=ne((()=>(0,l._)("h2",null," 大会情報 ",-1))),ie=ne((()=>(0,l._)("h3",null,"スコアランキング",-1))),de={key:0},re={colspan:"4",class:"loading"},se=(0,l.Uk)(" 読み込み中... "),ce=ne((()=>(0,l._)("span",{class:"cycle-loop"},"め",-1)));function pe(a,e,t,n,o,i){const d=(0,l.up)("router-link"),r=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",le,[oe,ie,(0,l.Wm)(r,{header:a.tableHeader,data:a.tableData,"row-attr":a.ranks},{"cell-playername":(0,l.w5)((a=>[(0,l.Wm)(d,{to:`/player/${a.row.player_id}`},{default:(0,l.w5)((()=>[(0,l.Uk)((0,P.zw)(a.row.player_display_name),1)])),_:2},1032,["to"])])),footer:(0,l.w5)((()=>[a.noMoreLoad?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("tr",de,[(0,l._)("td",re,[a.isLoading?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[se,ce],64)):((0,l.wg)(),(0,l.iD)("button",{key:1,class:"slim",onClick:e[0]||(e[0]=(...e)=>a.handleLoading&&a.handleLoading(...e))}," さらに読み込む "))])]))])),_:1},8,["header","data","row-attr"])])}const ue=a=>{const{api:e,payloadPath:t,pagerParam:n,pagerKey:l,limit:o}=a;let i="";const d=(0,p.iH)(!1),r=(0,p.iH)(!1),s=async()=>{const a=new URLSearchParams;i&&a.append(n,i),r.value=!0;try{const n=await m().get(e,{params:a}),s=n.data;if(!s.status)return window.alert("Failed to fetch: status=false"),[];const c=s.data[t];if(!c.length)return d.value=!0,[];const p=c[c.length-1];return i=p[l],c.length<o&&(d.value=!0),c}catch(s){window.alert("Failed to fetch: err="+s)}finally{r.value=!1}return[]};return{fetch:s,noMoreLoad:d,isLoading:r}};var me=(0,l.aZ)({components:{TableBase:fa},setup(){const a=(0,c.yj)(),e=a.params.competition_id,t=(0,p.iH)([]),{fetch:n,isLoading:o,noMoreLoad:i}=ue({api:`/api/player/competition/${e}/ranking`,payloadPath:"ranks",pagerParam:"rank_after",pagerKey:"rank",limit:100}),d=async()=>{const a=await n();a.length&&t.value.push(...a)};(0,l.bv)((()=>{d()}));const r=()=>{d()},s=[{width:"10%",align:"center",text:"順位"},{width:"20%",align:"center",text:"プレイヤーID"},{width:"45%",align:"left",text:"プレイヤー名"},{width:"15%",align:"right",text:"スコア"}],u=(0,l.Fl)((()=>t.value.map((a=>[a.rank.toString(),a.player_id,"##slot##cell-playername",a.score.toLocaleString()]))));return{ranks:t,isLoading:o,noMoreLoad:i,handleLoading:r,tableHeader:s,tableData:u}}});const he=(0,C.Z)(me,[["render",pe],["__scopeId","data-v-77713802"]]);var ge=he;const ye=a=>((0,l.dD)("data-v-79a29aca"),a=a(),(0,l.Cn)(),a),we={class:"single-player"},ve=ye((()=>(0,l._)("h2",null,"プレイヤー情報",-1))),fe=(0,l.Uk)(" 読み込み中… "),_e=ye((()=>(0,l._)("h3",null,"登録されたスコア",-1)));function be(a,e,t,n,o,i){const d=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",we,[ve,a.isLoading?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[fe],64)):(0,l.kq)("",!0),a.player?((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l._)("ul",null,[(0,l._)("li",null,"プレイヤーID: "+(0,P.zw)(a.player.id),1),(0,l._)("li",null,"プレイヤー名: "+(0,P.zw)(a.player.display_name),1),(0,l._)("li",null,"参加資格情報: "+(0,P.zw)(a.player.is_disqualified?"失格":"有効"),1)]),_e,(0,l.Wm)(d,{header:a.tableHeader,data:a.tableData},null,8,["header","data"])],64)):(0,l.kq)("",!0)])}var Ce=(0,l.aZ)({components:{TableBase:fa},setup(){const a=(0,c.yj)(),e=a.params.player_id,t=(0,p.iH)(!0),n=(0,p.iH)(),o=(0,p.iH)([]),i=async()=>{t.value=!0;try{const a=await m().get(`/api/player/player/${e}`);n.value=a.data.data.player,o.value=a.data.data.scores}catch(a){window.alert("failed to fetch player info: "+a)}finally{t.value=!1}};(0,l.bv)((()=>{i()}));const d=[{width:"80%",align:"left",text:"大会名"},{width:"20%",align:"right",text:"スコア"}],r=(0,l.Fl)((()=>o.value.map((a=>[a.competition_title,a.score.toLocaleString()]))));return{isLoading:t,player:n,scores:o,tableHeader:d,tableData:r}}});const ke=(0,C.Z)(Ce,[["render",be],["__scopeId","data-v-79a29aca"]]);var De=ke;const Ae={class:"organizer"},Le=(0,l.Uk)(" Organizer向けのメニュー画面だよ "),He=(0,l.Uk)("プレイヤー一覧"),Te=(0,l.Uk)("大会一覧"),xe=(0,l.Uk)("請求情報");function Ie(a,e,t,n,o,i){const d=(0,l.up)("router-link");return(0,l.wg)(),(0,l.iD)("div",Ae,[Le,(0,l._)("ul",null,[(0,l._)("li",null,[(0,l.Wm)(d,{to:"/organizer/players"},{default:(0,l.w5)((()=>[He])),_:1})]),(0,l._)("li",null,[(0,l.Wm)(d,{to:"/organizer/competitions"},{default:(0,l.w5)((()=>[Te])),_:1})]),(0,l._)("li",null,[(0,l.Wm)(d,{to:"/organizer/billing"},{default:(0,l.w5)((()=>[xe])),_:1})])])])}var ze=(0,l.aZ)({setup(){return{}}});const Ue=(0,C.Z)(ze,[["render",Ie]]);var Se=Ue;const Ze=a=>((0,l.dD)("data-v-210ca037"),a=a(),(0,l.Cn)(),a),Me={class:"players"},Pe=Ze((()=>(0,l._)("h2",null," プレイヤー一覧 ",-1))),Be=["value"];function We(a,e,t,o,i,d){const r=(0,l.up)("AddPlayersModal"),s=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",Me,[(0,l._)("button",{class:"add-players",onClick:e[0]||(e[0]=(...e)=>a.handleAddPlayers&&a.handleAddPlayers(...e))}," プレイヤー追加 "),(0,l.wy)((0,l.Wm)(r,{onClose:a.handleAddPlayersClose,onPlayersAdded:a.handlePlayersAdded},null,8,["onClose","onPlayersAdded"]),[[n.F8,a.showModal]]),Pe,(0,l.Wm)(s,{header:a.tableHeader,data:a.tableData,"row-attr":a.players},{"cell-action":(0,l.w5)((t=>[t.row.is_disqualified?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("button",{key:0,class:"slim",value:t.row.id,onClick:e[1]||(e[1]=(...e)=>a.handleDisqualify&&a.handleDisqualify(...e))}," 失格にする ",8,Be))])),_:1},8,["header","data","row-attr"])])}const Fe=a=>((0,l.dD)("data-v-8eb579a8"),a=a(),(0,l.Cn)(),a),Oe=Fe((()=>(0,l._)("h3",null,"プレイヤー追加",-1))),Ve=Fe((()=>(0,l._)("h4",null,"追加リスト",-1)));function qe(a,e,t,o,i,d){const r=(0,l.up)("ModalBase");return(0,l.wg)(),(0,l.j4)(r,{applyText:"作成","cancel-text":"キャンセル",onApply:a.handleApply},{default:(0,l.w5)((()=>[Oe,Ve,(0,l._)("table",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.playerNameList,(a=>((0,l.wg)(),(0,l.iD)("tr",{key:a},[(0,l._)("td",null,(0,P.zw)(a),1)])))),128))]),(0,l._)("form",null,[(0,l.wy)((0,l._)("input",{type:"text",name:"competition_name","onUpdate:modelValue":e[0]||(e[0]=e=>a.playerName=e)},null,512),[[n.nr,a.playerName]]),(0,l._)("button",{type:"button",class:"slim",onClick:e[1]||(e[1]=(...e)=>a.appendPlayer&&a.appendPlayer(...e))},"リストに追加")])])),_:1},8,["onApply"])}var Ne=(0,l.aZ)({name:"AddPlayersModal",components:{ModalBase:Ia},emits:["playersAdded"],setup(a,e){const t=(0,p.iH)([]),n=async()=>{const a=new URLSearchParams;t.value.forEach((e=>{a.append("display_name[]",e)})),l.value&&a.append("display_name[]",l.value);const n=await m().post("/api/organizer/players/add",a);n.data.status&&(e.emit("playersAdded"),l.value="",t.value=[])},l=(0,p.iH)(""),o=()=>{t.value.push(l.value),l.value=""};return{playerName:l,playerNameList:t,appendPlayer:o,handleApply:n}}});const Re=(0,C.Z)(Ne,[["render",qe],["__scopeId","data-v-8eb579a8"]]);var je=Re,$e=(0,l.aZ)({name:"PlayerListView",components:{TableBase:fa,AddPlayersModal:je},setup(){const a=(0,p.iH)([]),e=async()=>{const e=await m().get("/api/organizer/players");e.data.status?a.value=e.data.data.players:window.alert("failed to fetch players: status=false")};(0,l.bv)((()=>{e()}));const t=a=>{const e=a.target;if(!e)return;const t=e.value;n(t)},n=async a=>{const t=await m().post(`/api/organizer/player/${a}/disqualified`);t&&t.data.status?e():window.alert("faied to finish")},o=(0,p.iH)(!1),i=()=>{o.value=!0},d=()=>{o.value=!1},r=()=>{e()},s=[{width:"15%",align:"center",text:"プレイヤーID"},{width:"55%",align:"left",text:"プレイヤー名"},{width:"15%",align:"center",text:"参加資格"},{width:"15%",align:"center",text:""}],c=(0,l.Fl)((()=>a.value.map((a=>[a.id,a.display_name,a.is_disqualified?"失格":"","##slot##cell-action"]))));return{players:a,handleDisqualify:t,showModal:o,handleAddPlayers:i,handleAddPlayersClose:d,handlePlayersAdded:r,tableHeader:s,tableData:c}}});const Ye=(0,C.Z)($e,[["render",We],["__scopeId","data-v-210ca037"]]);var Ke=Ye;const Ee=a=>((0,l.dD)("data-v-732b0aa5"),a=a(),(0,l.Cn)(),a),Ge={class:"organizer-competition-list"},Je=Ee((()=>(0,l._)("h2",null," 大会一覧 ",-1))),Qe=["value"],Xe=["value"];function at(a,e,t,o,i,d){const r=(0,l.up)("AddCompetitionModal"),s=(0,l.up)("TableBase"),c=(0,l.up)("UploadCSVModal");return(0,l.wg)(),(0,l.iD)("div",Ge,[(0,l._)("button",{class:"add-competition",onClick:e[0]||(e[0]=(...e)=>a.handleAddCompetition&&a.handleAddCompetition(...e))}," 大会作成 "),(0,l.wy)((0,l.Wm)(r,{onClose:a.handleAddCompetitionClose,onCompetitionAdded:a.handleCompetitionAdded},null,8,["onClose","onCompetitionAdded"]),[[n.F8,a.showAddModal]]),Je,(0,l.Wm)(s,{header:a.tableHeader,data:a.tableData,"row-attr":a.competitions},{"cell-action":(0,l.w5)((t=>[t.row.is_finished?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l._)("button",{type:"button",class:"slim",value:t.row.id,onClick:e[1]||(e[1]=(...e)=>a.handleUploadCSV&&a.handleUploadCSV(...e))}," CSV入稿 ",8,Qe),(0,l._)("button",{type:"button",class:"slim",value:t.row.id,onClick:e[2]||(e[2]=(...e)=>a.handleCompleteCompetition&&a.handleCompleteCompetition(...e))}," 完了にする ",8,Xe)],64))])),_:1},8,["header","data","row-attr"]),(0,l.wy)((0,l.Wm)(c,{competitionId:a.selectedCompetitionId,competitionTitle:a.selectedCompetitionTitle,onClose:a.handleUploadCSVClose,onCsvUploaded:a.handleCSVUploaded},null,8,["competitionId","competitionTitle","onClose","onCsvUploaded"]),[[n.F8,a.showUploadModal]])])}const et=a=>((0,l.dD)("data-v-42a82408"),a=a(),(0,l.Cn)(),a),tt=et((()=>(0,l._)("h3",null,"新規大会追加",-1))),nt=et((()=>(0,l._)("label",null,"大会名",-1)));function lt(a,e,t,o,i,d){const r=(0,l.up)("ModalBase");return(0,l.wg)(),(0,l.j4)(r,{applyText:"作成","cancel-text":"キャンセル",onApply:a.handleApply},{default:(0,l.w5)((()=>[tt,(0,l._)("form",null,[nt,(0,l.wy)((0,l._)("input",{type:"text",name:"competition_name","onUpdate:modelValue":e[0]||(e[0]=e=>a.competitionName=e)},null,512),[[n.nr,a.competitionName]])])])),_:1},8,["onApply"])}var ot=(0,l.aZ)({name:"AddCompetitionModal",components:{ModalBase:Ia},emits:["competitionAdded"],setup(a,e){const t=(0,p.iH)(""),n=async()=>{const a=await m().post("/api/organizer/competitions/add",new URLSearchParams({title:t.value}));a.data.status&&e.emit("competitionAdded",{id:a.data.data.competition.id,title:a.data.data.competition.title,is_finished:a.data.data.competition.is_finished})};return{competitionName:t,handleApply:n}}});const it=(0,C.Z)(ot,[["render",lt],["__scopeId","data-v-42a82408"]]);var dt=it;const rt=a=>((0,l.dD)("data-v-04aba3f4"),a=a(),(0,l.Cn)(),a),st=rt((()=>(0,l._)("h3",null,"スコアアップロード",-1))),ct=rt((()=>(0,l._)("label",null,"CSVファイルを選択",-1)));function pt(a,e,t,n,o,i){const d=(0,l.up)("ModalBase");return(0,l.wg)(),(0,l.j4)(d,{applyText:"アップロード","cancel-text":"キャンセル",onApply:a.handleApply,onClose:a.handleClose},{default:(0,l.w5)((()=>[st,(0,l._)("p",null,"大会名: "+(0,P.zw)(a.competitionTitle)+" にスコアCSVを登録します。",1),(0,l._)("form",null,[ct,(0,l._)("input",{ref:"inputRef",type:"file",accept:"text/csv",name:"score",onChange:e[0]||(e[0]=(...e)=>a.handleFileChange&&a.handleFileChange(...e))},null,544)])])),_:1},8,["onApply","onClose"])}var ut=(0,l.aZ)({name:"UploadCSVModal",components:{ModalBase:Ia},props:{competitionId:{type:String,required:!0},competitionTitle:{type:String,required:!0}},emits:["csvUploaded"],setup(a,e){const t=(0,p.iH)(a.competitionId),n=(0,p.Vh)(a,"competitionId");(0,l.YP)(n,(a=>{t.value=a}));const o=(0,p.iH)(a.competitionTitle),i=(0,p.Vh)(a,"competitionTitle");(0,l.YP)(i,(a=>{o.value=a}));const d=async()=>{const a=new FormData;if(!r.value)return;a.append("scores",r.value);const n=await m().post(`/api/organizer/competition/${t.value}/score`,a,{headers:{"content-type":"multipart/form-data"}});n.data.status&&e.emit("csvUploaded",{uploaded:n.data.data.rows})},r=(0,p.iH)(),s=a=>{const e=a.target,t=e.files?e.files[0]:void 0;r.value=t},c=(0,p.iH)(null),u=()=>{c.value&&(c.value.value="")};return{inputRef:c,handleApply:d,handleFileChange:s,handleClose:u}}});const mt=(0,C.Z)(ut,[["render",pt],["__scopeId","data-v-04aba3f4"]]);var ht=mt,gt=(0,l.aZ)({name:"CompetitionListView",components:{TableBase:fa,AddCompetitionModal:dt,UploadCSVModal:ht},setup(){const a=(0,p.iH)([]),e=async()=>{const e=await m().get("/api/organizer/competitions");e.data.status?a.value=e.data.data.competitions:window.alert("failed to fetch competitions: status=false")};(0,l.bv)((()=>{e()}));const t=()=>{},n=(0,p.iH)(!1),o=(0,p.iH)(!1),i=a=>{const e=a.target;e&&d(e.value)},d=async a=>{const t=await m().post(`/api/organizer/competition/${a}/finish`);t&&t.data.status?e():window.alert("faied to finish")},r=(0,p.iH)(!1),s=()=>{r.value=!0},c=()=>{r.value=!1},u=()=>{e()},h=(0,p.iH)(""),g=(0,l.Fl)((()=>{const e=a.value.find((a=>a.id===h.value));return e?e.title:""})),y=(0,p.iH)(!1),w=a=>{const e=a.target;e&&(h.value=e.value,y.value=!0)},v=()=>{y.value=!1},f=a=>{window.alert(a.uploaded+"件のデータをアップロードしました。")},_=[{width:"20%",align:"center",text:"大会ID"},{width:"40%",align:"left",text:"大会名"},{width:"20%",align:"center",text:"完了ステータス"},{width:"20%",align:"center",text:"アクション"}],b=(0,l.Fl)((()=>a.value.map((a=>[a.id,a.title,a.is_finished?"大会完了":"開催中","##slot##cell-action"]))));return{competitions:a,isLoading:n,noMoreLoad:o,handleLoading:t,handleCompleteCompetition:i,showAddModal:r,handleAddCompetition:s,handleAddCompetitionClose:c,handleCompetitionAdded:u,showUploadModal:y,handleUploadCSV:w,handleUploadCSVClose:v,handleCSVUploaded:f,selectedCompetitionId:h,selectedCompetitionTitle:g,tableHeader:_,tableData:b}}});const yt=(0,C.Z)(gt,[["render",at],["__scopeId","data-v-732b0aa5"]]);var wt=yt;const vt=a=>((0,l.dD)("data-v-0726f086"),a=a(),(0,l.Cn)(),a),ft={class:"tenant-billing"},_t=vt((()=>(0,l._)("h2",null," 請求情報 ",-1))),bt={key:0},Ct=(0,l.Uk)("請求額: "),kt={class:"total-billing"},Dt=(0,l.Uk)(" になりま～す"),At=vt((()=>(0,l._)("h3",null,"大会ごとの請求明細",-1))),Lt=vt((()=>(0,l._)("p",null,"大会閲覧者数とは、スコア登録をしたプレイヤー以外で大会情報を閲覧した人です。大会ごとの請求額は、スコアを登録した人1人あたり100円、大会閲覧のみした人1人あたり10円で、合計金額が請求額となります。",-1))),Ht=(0,l.Uk)("大会が未完了の場合は0人(0円)になります。大会が完了しているかどうかのステータスは "),Tt=(0,l.Uk)("大会一覧"),xt=(0,l.Uk)(" 画面を参照してください。"),It={class:"supplement"},zt={class:"supplement"};function Ut(a,e,t,n,o,i){const d=(0,l.up)("router-link"),r=(0,l.up)("TableBase");return(0,l.wg)(),(0,l.iD)("div",ft,[_t,a.isLoading?((0,l.wg)(),(0,l.iD)("p",bt,"読み込み中… (とても長くなることがあります)")):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l._)("p",null,[Ct,(0,l._)("span",kt,(0,P.zw)(a.totalBilling.toLocaleString())+"円",1),Dt]),At,Lt,(0,l._)("p",null,[Ht,(0,l.Wm)(d,{to:"/organizer/competitions"},{default:(0,l.w5)((()=>[Tt])),_:1}),xt]),(0,l.Wm)(r,{header:a.tableHeader,data:a.tableData,"row-attr":a.billingReports},{"cell-player-count":(0,l.w5)((a=>[(0,l.Uk)((0,P.zw)(a.row.player_count)+"人 ",1),(0,l._)("span",It,"("+(0,P.zw)(a.row.billing_player_yen.toLocaleString())+"円)",1)])),"cell-visitor-count":(0,l.w5)((a=>[(0,l.Uk)((0,P.zw)(a.row.visitor_count)+"人 ",1),(0,l._)("span",zt,"("+(0,P.zw)(a.row.billing_visitor_yen.toLocaleString())+"円)",1)])),_:1},8,["header","data","row-attr"])],64))])}var St=(0,l.aZ)({components:{TableBase:fa},setup(){const a=(0,p.iH)(!0),e=(0,p.iH)([]),t=async()=>{const t=await m().get("/api/organizer/billing");e.value=t.data.data.reports,a.value=!1};(0,l.bv)((()=>{t()}));const n=(0,l.Fl)((()=>e.value.reduce(((a,e)=>a+e.billing_yen),0))),o=[{width:"15%",align:"center",text:"大会ID"},{width:"35%",align:"left",text:"大会名"},{width:"18%",align:"right",text:"スコア登録人数"},{width:"18%",align:"right",text:"大会閲覧者数"},{width:"14%",align:"right",text:"請求額"}],i=(0,l.Fl)((()=>e.value.map((a=>[a.competition_id,a.competition_title,"##slot##cell-player-count","##slot##cell-visitor-count",a.billing_yen.toLocaleString()+"円"]))));return{isLoading:a,totalBilling:n,billingReports:e,tableHeader:o,tableData:i}}});const Zt=(0,C.Z)(St,[["render",Ut],["__scopeId","data-v-0726f086"]]);var Mt=Zt;const Pt=[{path:"/",name:"lp",component:Ea},{path:"/mypage",name:"mypage",component:te},{path:"/competition/:competition_id",name:"competition",component:ge},{path:"/player/:player_id",name:"player",component:De},{path:"/organizer",name:"organizer",component:Se},{path:"/organizer/players",name:"players",component:Ke},{path:"/organizer/competitions",name:"competitions",component:wt},{path:"/organizer/billing",name:"billing",component:Mt},{path:"/:catchall(.*)",name:"notfound",redirect:"/"}],Bt=(0,c.p7)({history:(0,c.PO)("/"),routes:Pt});var Wt=Bt;const Ft=location.hostname;"admin"===Ft.split(".")[0]?(0,n.ri)(I).use(Fa).mount("#app"):(0,n.ri)(J).use(Wt).mount("#app")}},e={};function t(n){var l=e[n];if(void 0!==l)return l.exports;var o=e[n]={exports:{}};return a[n](o,o.exports,t),o.exports}t.m=a,function(){var a=[];t.O=function(e,n,l,o){if(!n){var i=1/0;for(c=0;c<a.length;c++){n=a[c][0],l=a[c][1],o=a[c][2];for(var d=!0,r=0;r<n.length;r++)(!1&o||i>=o)&&Object.keys(t.O).every((function(a){return t.O[a](n[r])}))?n.splice(r--,1):(d=!1,o<i&&(i=o));if(d){a.splice(c--,1);var s=l();void 0!==s&&(e=s)}}return e}o=o||0;for(var c=a.length;c>0&&a[c-1][2]>o;c--)a[c]=a[c-1];a[c]=[n,l,o]}}(),function(){t.n=function(a){var e=a&&a.__esModule?function(){return a["default"]}:function(){return a};return t.d(e,{a:e}),e}}(),function(){t.d=function(a,e){for(var n in e)t.o(e,n)&&!t.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:e[n]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()}(),function(){t.o=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)}}(),function(){var a={143:0};t.O.j=function(e){return 0===a[e]};var e=function(e,n){var l,o,i=n[0],d=n[1],r=n[2],s=0;if(i.some((function(e){return 0!==a[e]}))){for(l in d)t.o(d,l)&&(t.m[l]=d[l]);if(r)var c=r(t)}for(e&&e(n);s<i.length;s++)o=i[s],t.o(a,o)&&a[o]&&a[o][0](),a[o]=0;return t.O(c)},n=self["webpackChunkisuports"]=self["webpackChunkisuports"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=t.O(void 0,[998],(function(){return t(5317)}));n=t.O(n)})();