# bench

# TODO

- éµãŒPEMç‰ˆã€webappã¯ã¾ã å¤šåˆ†jwkç‰ˆãªã®ã§å‹•ã‹ãªã„ã§ã™


## How to run

å‰æ

- repo root ã«ã„ã‚‹çŠ¶æ…‹
- docker-compose ã§èµ·å‹•ã—ã¦ã„ã‚‹çŠ¶æ…‹
  - nginx ãŒ port 80
  - mysql ãŒ port 13306

```console
$ gh release download dummydata/20220421_0056-prod # ã‚‚ã—ãã¯releaseã‹ã‚‰isucon_listen80_dump_prod.tar.gzã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
$ tar xvf isucon_listen80_dump_prod.tar.gz
$ mysql -uroot -proot --host 127.0.0.1 --port 13306 < isucon_listen80_dump.sql
$ cd bench
$ make
$ ./bench -target-url http://localhost  # nginxã®portã‚’å¤‰ãˆã¦ã„ã‚‹å ´åˆã¯portã‚’åˆã‚ã›ã‚‹
```


# ãƒ¡ãƒ¢

ãªã‚“ã¨ã‹Actionã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œã£ã¦é€ã£ã¦è¿”ã£ã¦ããŸresã‚’ValidateResponseã§æ¤œè¨¼ã—ã¦ã‚‹ã‚“ã ã‘ã©ã€ã“ã®2ã¤ã®é–¢æ•°ã«é–¢ä¿‚ãŒãªã„ã®ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹ã‹ã‚‰çµæœå–å¾—å®Œäº†ã¾ã§ã®æ™‚åˆ»(ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ )ã‚’å…ƒã«ãªã«ã‹ã™ã‚‹ã®ãŒã§ããªã„
nç§’è¶…ãˆãŸã‚‰ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§ã¯ãªã„ã‘ã©0ç‚¹ã€ã¿ãŸã„ãªèª¿æ•´ãŒã‚„ã‚Šã¥ã‚‰ã„ã®ã§ãã“ã ã‘ä½œã‚Šã‚’å¤‰ãˆãŸã„æ°—æŒã¡
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ctxã‚’wrapã—ã¦ã€ãã“ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡æ™‚ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦validateã«ã‚‚ctxã‚’æ¸¡ã—ã¦ãã‚Œã‚’ã¿ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã‹


## ã‚·ãƒŠãƒªã‚ªä¸€æ¡ˆ

2022-06-03æ™‚ç‚¹

ğŸ“  comment: æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã§ã¯å…¥å¿µã«ã€è² è·èµ°è¡Œä¸­ã¯æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã»ã¼ã—ãªã„ã€ãŸã ã—å¤±æ ¼403ç³»ã¯ãƒã‚§ãƒƒã‚¯ã™ã‚‹

### æ—¢å­˜ãƒ†ãƒŠãƒ³ãƒˆ(åˆæœŸãƒ‡ãƒ¼ã‚¿)

- playerè¿½åŠ 
- å„competition
  - çµ‚äº†å‰ãªã‚‰
    - CSVå…¥ç¨¿
      - åˆæœŸãƒ‡ãƒ¼ã‚¿ã«ã¾ã¨ã¾ã£ãŸæƒ…å ±jsonã«å…¥ã‚Œãªã„ã¨ã„ã‘ãªã„
      - ãƒ†ãƒŠãƒ³ãƒˆå†…ã«å­˜åœ¨ã™ã‚‹PlayerNameãŒã‚ã‚Œã°è‰¯ã„
    - çµ‚äº†
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—
- å„player
  - :memo: å¤±æ ¼APIã¯åˆæœŸãƒ‡ãƒ¼ã‚¿playerã«å¤±æ ¼è€…ãŒå¢—ãˆã¦ã„ã£ã¦æˆ»ã™ã®ãŒå¤§å¤‰ãªã®ã§ã‚„ã‚‰ãªã„
  - playeré–²è¦§
    - check: å¤±æ ¼è€…ãªã‚‰403
    - check: è¤‡æ•°å¤§ä¼šã«å‚åŠ ã—ã¦ã„ã‚‹å‚åŠ è€…ã¯ãã‚Œãã‚Œã®çµæœãŒã‚ã‚‹ã“ã¨
    - ãƒ†ãƒŠãƒ³ãƒˆå†…ã®åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼å‚ç…§ã€åˆæœŸãƒ‡ãƒ¼ã‚¿jsonã«å«ã‚ãªã„ã¨ã‚ã‹ã‚‰ãªã„
      - benchã§sqliteã§èª­ã‚“ã˜ã‚ƒã† 
      - å„playerã®ScoreãŒå­˜åœ¨ã™ã‚‹CompetitionIDã®ä¸€è¦§ã‚ã‚‹ã„ã¯å‡ºå ´ã—ãŸcompetitionã®ç·æ•°
      - ç·æ•°ã‚’å…¥ã‚Œã‚‹å ´åˆã¯ã‚·ãƒŠãƒªã‚ªå†…ã§CSVå…¥ç¨¿ã™ã‚‹competitionã¨è¢«ã‚‹ã¨ã‚ºãƒ¬ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
  - rankingé–²è¦§
    - check: å¤±æ ¼è€…ãªã‚‰403
- è«‹æ±‚æƒ…å ±é–²è¦§
  - check: ãƒ†ãƒŠãƒ³ãƒˆå†…ã«å­˜åœ¨ã™ã‚‹playerç·æ•°ãŒåˆã£ã¦ã„ã‚‹ã‹
  - åˆæœŸãƒ‡ãƒ¼ã‚¿jsonã«å«ã‚ãªã„ã¨ã‚ã‹ã‚‰ãªã„ã€tenantå†…ã®playerç·æ•°ãŒã‚ã‚Œã°è‰¯ã„

### æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆ

- playerè¿½åŠ 
  - è² è·ãƒã‚¿: 1ãƒ†ãƒŠãƒ³ãƒˆã®playeræ•°ãŒçˆ†å¢—ã™ã‚‹
- competitionè¿½åŠ 
  - CSVå…¥ç¨¿
    - è² è·ãƒã‚¿: å·¨å¤§
      - å­˜åœ¨ã—ãªã„PlayerNameã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šãã†
      - PlayerNameé‡è¤‡ã¯OK é‡è¤‡ãŒå¤šã™ãã¦ãƒ‡ã‚«ã„
      - å¤±æ ¼è€…ãŒå¤šãã¦ãƒ‡ã‚«ã„ ãƒ†ãƒŠãƒ³ãƒˆã®å¤±æ ¼è€…è¡ŒãŒå¤šã„
  - çµ‚äº†
  - ranking
    - check: å¤±æ ¼è€…ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨
    - check: ãƒšãƒ¼ã‚¸ãƒ³ã‚°ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨
- å„player
  - playerå–å¾—
    - check: è¤‡æ•°å¤§ä¼šãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨
  - rankingå–å¾—
    - check: è¤‡æ•°å¤§ä¼šãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨
 billingå–å¾—  
 - check: ä¸Šé™20ï¼Ÿ
